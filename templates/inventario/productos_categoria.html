{% extends 'dashboard/base_system.html' %}

{% load static %}

{% block title %}Dashboard{% endblock %}

{% block extra_head %}
    <link rel="stylesheet" href="{% static 'styles/dashboard.css' %}">
{% endblock %}

{% block content %}
    <div class="content-header">
        <div class="d-flex flex-column justify-content-between align-items-center mb-3 border-bottom w-100">
            <h1 class="text-center">
                Productos ({{ categoria.nombre|capfirst }})
                <span class="badge bg-success text-white mb-1 badge-nivel">
                    {{ user.profile.nivel_usuario|capfirst }}
                </span>
            </h1>
            <a href="{% url 'productos' %}" class="btn btn-outline-success btn-outline-brown shadow-sm rounded-pill mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left me-2" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                </svg>
                Volver
            </a>
        </div>
        <p style="text-align: justify;">Productos del area de {{categoria.nombre}}. {{categoria.definicion}}</p>
    </div>

    <div class="filters my-4">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-6 col-md-6">
                <div class="input-group input-group-lg shadow-sm rounded-3">
                    <span class="input-group-text bg-white border-end-0">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.114l2.293 2.293a1 1 0 0 0 1.414-1.414l-2.293-2.293a.5.5 0 0 0-.114-.098zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </span>
                    <input type="text" class="form-control border-start-0" id="search-input" name="search" placeholder="Buscar por nombre o ID..." value="{{ request.GET.search }}">
                </div>
            </div>

            <div class="col-6 col-md-6 d-flex gap-2">
                <button type="submit" class="btn btn-outline-success btn-outline-brown btn-lg shadow-sm">
                    Buscar
                </button>
                
                <a href="{% url 'productosCategoria' categoria.nombre %}" class="btn btn-outline-secondary btn-lg shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0z"/>
                        <path fill-rule="evenodd" d="M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0z"/>
                    </svg>
                    <span class="d-none d-sm-inline ms-1">Limpiar</span>
                </a>
            </div>
        </form>
    </div>

    <div class="w-100">
        <h2 class="mb-4 text-success text-brown">Inventario de Productos</h2>     
        <div class="overflow-x-auto rounded-3 shadow-sm border border-success border-brown">
            <table class="table table-striped table-hover align-middle">
                <thead class="table-success table-brown text-white text-center text-nowrap">
                    <tr>
                        <th scope="col" class="py-3 px-4">ID Producto</th>
                        <th scope="col" class="py-3 px-4">Nombre</th>
                        <th scope="col" class="py-3 px-4">Área</th>
                        <th scope="col" class="py-3 px-4">Precio</th>
                        <th scope="col" class="py-3 px-4">Descripción</th>
                        <th scope="col" class="py-3 px-4">Acciones</th>
                    </tr>
                </thead>
                <tbody class="text-center text-nowrap">
                    {% for producto in productosList %}
                    <tr>
                        <th scope="row" class="py-3 px-4">
                            <span class="badge bg-secondary">{{ producto.area.prefijo_codigo }}-{{ producto.codigoProducto }}</span>
                        </th>
                        <td class="py-3 px-4">
                            <strong class="text-success text-brown">{{ producto.nombre }}</strong>
                        </td>
                        <td class="py-3 px-4">
                            <span class="badge bg-success bg-brown text-white">{{ producto.area.nombre|capfirst }}</span>
                        </td>
                        <td class="py-3 px-4">
                            <span class="fw-bold text-success text-brown">{{ producto.precio_display|floatformat:2 }} {{ configuracion.1 }}</span>
                        </td>
                        <td class="py-3 px-4 text-muted">
                            {{ producto.descripcion|truncatechars:100 }}
                        </td>
                        <td class="py-3 px-4">
                            <a href="#" class="btn btn-outline-success btn-outline-brown btn-sm">Ver Lotes</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="text-center text-danger py-4">
                            ¡No se encontraron productos en el inventario!
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
{% endblock %}


{% block extra_js %}
    
{% endblock %}